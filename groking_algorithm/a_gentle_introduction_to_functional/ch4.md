Gi·ªõi thi·ªáu v·ªÅ l·∫≠p tr√¨nh ch·ª©c nƒÉng

B√†i vi·∫øt d·ª±a tr√™n b√†i vi·∫øt [A Gentle Introduction to Functional JavaScript: Part 4](https://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-style) c·ªßa blogger James Sinclair nh·∫±m m·ª•c ƒë√≠ch h·ªçc t·∫≠p. N·∫øu th·∫•y h·ªØu √≠ch b·∫°n c√≥ th·ªÉ theo d√µi RSS c·ªßa [t√°c gi·∫£](https://jrsinclair.com/index.rss).

Ph·∫ßn 4

Vi·∫øt b·ªüi James Sinclair ng√†y 11th th√°ng 2 nƒÉm 2016

ƒê√¢y l√† ph·∫ßn b·ªën trong b·ªën ph·∫ßn gi·ªõi thi·ªáu v·ªÅ l·∫≠p tr√¨nh ch·ª©c nƒÉng trong Javascript. ·ªû b√†i vi·∫øt tr∆∞·ªõc, ch√∫ng ta ƒë√£ ƒëi t√¨m hi·ªÉu v·ªÅ **h√†m Higher-Order**: h√†m t·∫°o h√†m/h√†m tr·∫£ v·ªÅ h√†m. Trong b√†i n√†y, ch√∫ng ta s·∫Ω xem c√°ch s·ª≠ d·ª•ng nh∆∞ng c√¥ng c·ª• n√†y v·ªõi phong c√°ch

+ Ph·∫ßn 1: [C√°c ch·∫•t li·ªáu v√† ƒë·ªông l·ª±c](https://medium.com/@vnknowledge/b%C3%A0i-d%E1%BB%8Bch-gi%E1%BB%9Bi-thi%E1%BB%87u-v%E1%BB%81-l%E1%BA%ADp-tr%C3%ACnh-ch%E1%BB%A9c-n%C4%83ng-7508808a39e5)
+ Ph·∫ßn 2: [L√†m vi·ªác v·ªõi m·∫£ng v√† danh s√°ch](https://medium.com/@vnknowledge/gioi-thieu-ve-lap-trinh-chuc-nang-p2-2b496ffaf524)
+ Ph·∫ßn 3: [H√†m ƒë·ªÉ t·∫°o h√†m](https://medium.com/@vnknowledge/ph%E1%BA%A7n-3-dba41c4d2408)
+ Ph·∫ßn 4: L√†m vi·ªác v·ªõi phong c√°ch

# I. Phong c√°ch

Nh∆∞ v·∫≠y ch√∫ng ta ƒë√£ bi·∫øt v·ªÅ _partial_, _compose_, _curry_ v√† _pipe_, c√°ch ta c√≥ th·ªÉ k·∫øt h·ª£p ch√∫ng v·ªõi nh·ªØng h√†m nh·ªè, ƒë∆°n gi·∫£n ƒë·ªÉ c√≥ th·ªÉ th·ª±c hi·ªán ƒë∆∞·ª£c c√°c nhi·ªám v·ª• l·ªõn, ph·ª©c t·∫°p h∆°n. Nh∆∞ng n√≥ c√≥ √Ω nghƒ©a v·ªõi ch√∫ng ta? T·∫°i sao c·∫ßn quan t√¢m t·ªõi n√≥ khi ch√∫ng ta ƒë√£ vi·∫øt code h·ª£p l·ªá.

M·ªôt ph·∫ßn cho c√¢u tr·∫£ l·ªùi l√† ta n√≥ cho ta th√™m c√¥ng c·ª• ƒë·ªÉ ho√†n th√†nh c√¥ng vi·ªác - Khi b·∫°n bi·∫øt c√°ch s·ª≠ d·ª•ng ch√∫ng - l·∫≠p tr√¨nh ch·ª©c nƒÉng s·∫Ω tr·ªü th√†nh b·ªô c√¥ng c·ª• ti·ªán √≠ch cho vi·ªác vi·∫øt code. Qu·∫£ th·∫≠t n√≥ ƒë∆∞a ra m·ªôt phong c√°ch l·∫≠p tr√¨nh ho√†n to√†n m·ªõi, kh√°i qu√°t h√≥a c√°c v·∫•n ƒë·ªÅ v√† gi·∫£i ph√°p.

C√≥ 2 t√≠nh nƒÉng quan tr·ªçng trong l·∫≠p tr√¨nh h√†m:

+ Vi·∫øt h√†m ‚Äòs·∫°ch‚Äô - (l.h·ªá v·ªõi ch·ªß ƒë·ªÅ th·ª±c ph·∫©m s·∫°ch ng√†y nay)
+ Phong c√°ch l·∫≠p tr√¨nh Pointfree, c√°i m√† kh√¥ng quan tr·ªçng nh∆∞ng ƒë·ªß t·ªët ƒë·ªÉ hi·ªÉu.

Thu·∫≠t ng·ªØ: #pure\_function #pointfree

## 1. H√†m s·∫°ch

N·∫øu b·∫°n ƒë·ªçc v·ªÅ l·∫≠p tr√¨nh ch·ª©c nƒÉng, b·∫°n s·∫Ω b·∫Øt g·∫∑p kh√°i ni·ªám v·ªÅ _h√†m_ ‚Äò_s·∫°ch_‚Äô v√† ‚Äò_d∆°_‚Äô. H√†m s·∫°ch l√† nh·ªØng h√†m th·ªèa m√£n 2 ƒëi·ªÅu ki·ªán:

+ Truy·ªÅn v√†o h√†m v·ªõi c√πng ƒë·ªëi s·ªë lu√¥n tr·∫£ v·ªÅ c√πng k·∫øt qu·∫£. K·∫øt qu·∫£ ch·ªâ ph·ª• thu·ªôc v√†o c√°c ƒë·ªëi s·ªë.
+ G·ªçi h√†m kh√¥ng t·∫°o ra b·∫•t k√¨ hi·ªáu ·ª©ng ph·ª• n√†o nh∆∞ 
kh√¥ng g·ª≠i request qua m·∫°ng, kh√¥ng ƒë·ªçc hay vi·∫øt file, kh√¥ng truy v·∫•n c∆° s·ªü d·ªØ li·ªáu, kh√¥ng thay ƒë·ªïi c√°c th·∫ª DOM, kh√¥ng thay ƒë·ªïi bi·∫øn to√†n c·ª•c, kh√¥ng hi·ªÉn th·ªã ·ªü m√†n h√¨nh console.

Trong l·∫≠p tr√¨nh ch·ª©c nƒÉng, c√°c coder s·∫Ω tr√°nh ƒë·ª•ng ƒë·∫øn c√°c _h√†m d∆°_ m·ªôt c√°ch t·ªëi ƒëa. V·∫•n ƒë·ªÅ l√† c√≥ nhi·ªÅu n∆°i trong ch∆∞∆°ng t·∫°o ra hi·ªáu ·ª©ng ph·ª•. T·∫°o c√°c request qua m·∫°ng, thao t√°c th·∫ª DOM l√† nh·ªØng g√¨ ·ª©ng d·ª•ng web l√†m; n√≥ l√† nguy√™n nh√¢n Javascript ƒë∆∞·ª£c ph√°t minh ra.

Nh·ªØng coder theo style l·∫≠p tr√¨nh ch·ª©c nƒÉng n√™n l√†m g√¨? C√¢u tr·∫£ l·ªùi l√† kh√¥ng ph·∫£i l√∫c n√†o c≈©ng n√≥i kh√¥ng v·ªõi ‚ÄòH√†m d∆°‚Äô, ch·ªâ s·ª≠ d·ª•ng khi th·ª±c s·ª± c·∫ßn thi·∫øt. Ch√∫ng ta s·∫Ω l√™n √Ω t∆∞·ªüng, c√≥ k·∫ø ho·∫°ch ki·ªÉm tra cho nh·ªØng g√¨ mu·ªën l√†m tr∆∞·ªõc khi ta th·ª≠ th·ª±c hi·ªán n√≥. Eric Elliot c√≥ n√≥i v·ªÅ n√≥ trong b√†i vi·∫øt ‚Äò[The Dao of Immuability](https://medium.com/javascript-scene/the-dao-of-immutability-9f91a70c88cd)‚Äô:

```
Separation: Logic is thought. Effects are action. Therefore the wise think before acting, and act only when the thinking is done.

If you try to perform effects and logic at the same time, you may create hidden side effects which cause bugs in the logic. Keep functions small. Do one thing at a time, and do it well.
```

N√≥ th·ªÉ hi·ªán √Ω nghƒ©a: H√£y xem x√©t c√°c v·∫•n ƒë·ªÅ m·ªôt c√°ch kh√¥n ngoan tr∆∞·ªõc khi l√†m g√¨ ƒë√≥, khi ƒë√≥ ta c√≥ th·ªÉ h·∫°n ch·∫ø t·ªëi ƒëa c√°c hi·ªáu ·ª©ng ph·ª•, l·ªói trong ch∆∞∆°ng tr√¨nh.

M·ªôt c√°ch kh√°c ƒë·ªÉ nghƒ© l√† s·ª± kh√°c nhau gi·ªØa s·ª≠ d·ª•ng m·ªôt kh·∫©u s√∫ng m√°y v√† m·ªôt kh·∫©u s√∫ng b·∫Øn t·ªâa. V·ªõi m·ªôt kh·∫©u sung m√°y, ta c√≥ th·ªÉ b·∫Øn th·∫£ c·ª≠a, bao nhi√™u c≈©ng ƒë∆∞·ª£c. Theo c√°ch n√†y ta c√≥ th·ªÉ th·ªÉ b·∫Øn tr√∫ng m·ª•c ti√™u, nh∆∞ng c≈©ng b·∫Øn t·ªõi nh·ªØng th·ª© m√† ta kh√¥ng ch·ªß ƒë·ªông nh·∫Øm t·ªõi. M·ªôt kh·∫©u s√∫ng b·∫Øn t·ªâa th√¨ kh√°c, ta s·∫Ω t√¨m m·ªôt n∆°i thu·∫≠t l·ª£i ƒë·ªÉ h√†nh ƒë·ªông, l√™n n√≤ng, t√≠nh to√°n t·ªëc ƒë·ªô gi√≥ v√† kho·∫£ng c√°ch t·ªõi m·ª•c ti·ªáu. M·ªôt c√°ch ki√™n nh·∫´n, ch·ªù ƒë·ª£i ƒë·∫øn ƒë√∫ng th·ªùi ƒëi·ªÉm, tr∆∞·ªõc khi b√≥p c√≤. ƒê·ª° t·ªën ƒë·∫°n h∆°n nhi·ªÅu v√† c√≥ t·ªâ l·ªá ch√≠nh x√°c cao.

L√†m th·∫ø n√†o ƒë·ªÉ t·∫°o ra h√†m s·∫°ch? H√£y xem v√≠ d·ª• sau:

```js
var myGlobalMessage = '{{verb}} me';

var impureInstruction = function(verb) {
    return myGlobalMessage.replace('{{verb}}', verb);
}

var eatMe = impureInstruction('Eat');
// ‚á® 'Eat me'

var drinkMe = impureInstruction('Drink');
// ‚á® 'Drink me'
```

ƒê√¢y kh√¥ng ph·∫£i l√† m·ªôt h√†m s·∫°ch b·ªüi v√¨ n√≥ ph·ª• thu·ªôc v√†o bi·∫øn to√†n c·ª•c **myGlobalMessage**. N·∫øu bi·∫øn n√†y thay ƒë·ªïi, ta kh√¥ng th·ªÉ kh·∫≥ng ƒë·ªãnh k·∫øt qu·∫£ m√† **impureInstruction** t·∫°o ra. V·∫≠y n√™n, m·ªôt c√°ch ƒë·ªÉ ‚Äòl√†m s·∫°ch‚Äô n√≥ l√† ƒë∆∞a bi·∫øn n√†y v√†o b√™n trong:

```js
var pureInstruction = function (verb) {
    var message =  '{{verb}} me';
    return message.replace('{{verb}}', verb);
}
```

B√¢y gi·ªù, h√†m n√†y lu√¥n tr·∫£ v·ªÅ m·ªôt k·∫øt qu·∫£ m·ªói khi n√≥ nh·∫≠n ƒë∆∞·ª£c c√°c gi√° tr·ªã t∆∞∆°ng t·ª± ·ªü ƒë·ªëi s·ªë. Tuy nhi√™n kh√¥ng ph·∫£i l√∫c n√†o ch√∫ng ta c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng kƒ© thu·∫≠t n√†y. V√≠ d·ª•:

```js
var getHTMLImpure = function(id) {
    var el = document.getElementById(id);
    return el.innerHTML;
}
```

ƒê√¢y v·∫´n l√† m·ªôt h√†m d∆° b·ªüi v√¨ n√≥ ph·ª• v√†o **document** ƒë·ªÉ truy xu·∫•t t·ªõi DOM. N·∫øu DOM thay ƒë·ªïi, n√≥ c√≥ th·ªÉ d·∫´n t·ªõi nh·ªØng k·∫øt qu·∫£ kh√°c nhau. V√¨ _document_ l√† m·ªôt API c·ªßa tr√¨nh duy·ªát, s·∫Ω kh√¥ng th·ªÉ ƒë∆∞a _document_ v√†o trong h√†m nh∆∞ v√≠ d·ª• tr∆∞·ªõc ƒë√≥, nh∆∞ng ch√∫ng ta c√≥ th·ªÉ truy·ªÅn n√≥ nh∆∞ l√† m·ªôt tham s·ªë:

```js
var getHTML = function(doc, id) {
    var el = doc.getElementById(id);
    return el.innerHTML;
}
```

M·ªõi nh√¨n c√≥ v·∫ª th·∫•y v√¥ nghƒ©a, nh∆∞ng ƒë√¢y l·∫°i m·ªôt kƒ© thu·∫≠t c·∫ßn thi·∫øt. H√¨nh dung khi ch√∫ng ta ph·∫£i ƒëi ki·ªÉm th·ª≠ (unit test) cho h√†m n√†y. Ch√∫ng ta th∆∞·ªùng ph·∫£i m√¥ ph·ªèng m·ªôt ph·∫ßn ƒë·ªëi t∆∞·ª£ng __document__ c·ªßa tr√¨nh duy·ªát ƒë·ªÉ c√≥ th·ªÉ vi·∫øt test. N√™n khi c√≥ tham s·ªë _doc_, m·ªçi th·ª© tr·ªü n√™n d·ªÖ d√†ng ƒë·ªÉ truy·ªÅn v√†o ƒë·ªëi t∆∞·ª£ng m√¥ ph·ªèng ƒë√≥ - (c√≥ th·ªÉ g·ªçi n√≥ ‚Äò_stub_‚Äô):

```js
var stubDoc = {
    getElementById: function(id) {
        if (id === 'jabberwocky') {
            return {
                innerHTML: '<p>Twas brillig‚Ä¶'
            };
        }
    }
};

// ...

assert.equal(getHTML('jabberwocky'), '<p>Twas brillig‚Ä¶');
//=> test passes
```

Nh·ªù _stub_ v·ª´a t·∫°o ra, ch√∫ng ta c√≥ th·ªÉ test h√†m _getHTML_ m√† kh√¥ng c·∫ßn t·ªõi tr√¨nh duy·ªát. Ta c√≥ th·ªÉ ch·∫°y n√≥ m√¥i tr∆∞·ªùng NodeJs v√† qu√° tr√¨nh test c≈©ng nhanh h∆°n nhi·ªÅu l·∫ßn n·∫øu so s√°nh gi·ªØa m·ªôt ƒë·ªëi t∆∞·ª£ng m√¥ ph·ªèng v·ªõi m·ªôt ƒë·ªëi t∆∞·ª£ng ƒë·∫ßy ƒë·ªß nh∆∞ _document_.

C√≤n m·ªôt c√°ch kh√°c l√†m s·∫°ch h√†m l√† ta s·∫Ω tr·∫£ v·ªÅ m·ªôt h√†m kh√°c m√† h√†m n√†y s·∫Ω th·ª±c hi·ªán nh·ªØng th·ª© kh√¥ng s·∫°ch khi ƒë∆∞·ª£c th·ª±c thi. C√°ch n√†y h∆°i m∆∞u m·∫πo nh∆∞ng ho√†n to√†n h·ª£p l·ªá. V√≠ d·ª•:

```js
var htmlGetter = function(id) {
    return function() {
        var el = document.getElementById(id);
    return el.innerHTML;
    }
}
```

Trong v√≠ d·ª• n√†y, *htmlGetter* l√† h√†m s·∫°ch b·ªüi v√¨ n√≥ kh√¥ng truy xu·∫•t t·ªõi bi·∫øn to√†n c·ª•c. N√≥ lu√¥n tr·∫£ v·ªÅ ch√≠nh x√°c m·ªôt h√†m.

Theo ƒë√°nh gi√°, s·ª≠ d·ª•ng c√°ch n√†y kh√¥ng h·ªØu √≠ch cho vi·ªác ki·ªÉm th·ª≠, v√† n√≥ c≈©ng kh√¥ng lo·∫°i b·ªè ph·∫ßn ‚Äòd∆°‚Äô ch√≠nh l√† _document_ kia. ƒê√¢y ch·ªâ l√† m·ªôt c√°ch tr√¨ ho√£n v·∫•n ƒë·ªÅ. Tuy nhi√™n, ƒë√¢y c≈©ng ph·∫£i l√† m·ªôt ƒëi·ªÅu x·∫•u. [üòµ thi·∫øu]

## 2. Pointfree

Pointfree l√† m·ªôt phong c√°ch l·∫≠p tr√¨nh c·ª• th·ªÉ m√† c√°c h√†m __higher-order__ nh∆∞ _curry_ v√† _compose_ l√†m cho c√≥ th·ªÉ. ƒê·ªÉ gi·∫£i th√≠ch, h√£y tr·ªü l·∫°i v√≠ d·ª• b√†i th∆° trong b√†i vi·∫øt tr∆∞·ªõc:

```js
var poem = 'Twas brillig, and the slithy toves\n' + 
    'Did gyre and gimble in the wabe;\n' +
    'All mimsy were the borogoves,\n' +
    'And the mome raths outgrabe.';

var replace = curry(function(find, replacement, str) {
    var regex = new RegExp(find, 'g');
    return str.replace(regex, replacement);
});

var wrapWith = curry(function(tag, str) {
    return '<' + tag + '>' + str + '</' + tag + '>'; 
});

var addBreaks      = replace('\n', '<br/>\n');
var replaceBrillig = replace('brillig', wrapWith('em', 'four o‚Äôclock in the afternoon'));
var wrapP          = wrapWith('p');
var wrapBlockquote = wrapWith('blockquote');

var modifyPoem = compose(wrapBlockquote, wrapP, addBreaks, replaceBrillig);
```

‚ñ™ Ch√∫ √Ω, _compose_ mong mu·ªën m·ªói h√†m ƒë∆∞·ª£c truy·ªÅn v√†o ch·ªâ nh·∫≠n m·ªôt tham s·ªë. V√¨ v·∫≠y, ch√∫ng ta s·ª≠ d·ª•ng _curry_ ƒë·ªÉ h√†m nhi·ªÅu tham s·ªë l√† _replace_ v√† _wrapWith_ v√†o c√°c h√†m m·ªôt tham s·ªë. M·ªôt ƒëi·ªÉm n·ªØa c·∫ßn l∆∞u √Ω l√† th·ª© t·ª± tham s·ªë, v√≠ d·ª• h√†m _wrapWith_ nh·∫≠n t√™n th·∫ª ·ªü tham s·ªë m·ªôt, chu·ªói c·∫ßn x·ª≠ l√≠ ·ªü tham s·ªë hai. C·∫©n th·∫≠n thi·∫øt l·∫≠p th·ª© t·ª± khi t·∫°o m·ªôt h√†m, qu√° tr√¨nh t·∫°o h√†m tr·∫£ v·ªÅ t·ª´ _compose_ d·ªÖ tr√¥i ch·∫£y h∆°n ([üê´](#order_parameters))

B·∫°n c√≥ th·ªÉ vi·∫øt code theo c√°ch n√†y, nh∆∞ng ch√∫ √Ω hi·ªáu ·ª©ng ph·ª• ƒëi k√®m. Khi ta t·∫°o ƒë∆∞·ª£c h√†m _modifyPoeam_, ch√∫ng ta kh√¥ng bao gi·ªù ƒë·ªÉ √Ω l√† n√≥ nh·∫≠n ch·ªâ m·ªôt ƒë·ªëi s·ªë. V√† n·∫øu quan s√°t h√†m c√†-ri _addBreaks_, *replaceBrillig*, *wrapP* v√† *wrapBlockquote*, kh√¥ng h√†m n√†o trong s·ªë n√†y b√°o r·∫±ng ch√∫ng ch·ªâ nh·∫≠n ch·ªâ m·ªôt chu·ªói. ƒê√¢y ƒë∆∞·ª£c g·ªçi l√† ki·ªÉu l·∫≠p tr√¨nh pointfree: b·∫Øt ƒë·∫ßu v·ªõi c√°c c√°c h√†m ti·ªán √≠ch (nh∆∞ Ramda hay functional.js) v√† vi·∫øt code theo c√°ch n√†y, b·∫°n kh√¥ng bao gi·ªù c·∫ßn ƒë·ªÉ √Ω t·ªõi bi·∫øn input.

ƒêi·ªÅu n√†y ƒëem t·ªõi g√¨ cho ch√∫ng ta? N√≥ √©p ch√∫ng ta s·ª≠ dung _compose_, _curry_ v√† _pipe_, bla bla.. T·∫°o ra c√°c h√†m nh·ªè, ƒë∆°n gi·∫£n sau ƒë√≥ l·∫Øp gh√©p ra theo c√°ch c√≥ √Ω nghƒ©a.

<a id="order_parameters">\*üê´: H·∫ßu h·∫øt c√°c th∆∞ vi·ªán l·∫≠p tr√¨nh ch·ª©c nƒÉng (nh∆∞ [Ramda](http://ramdajs.com)) cung c·∫•p c√°c ti·ªán √≠ch ƒë·ªÉ x·ª≠ l√≠ c√°c h√†m c√≥ th·ª© t·ª± tham s·ªë kh√¥ng ƒë∆∞·ª£c thu·∫≠n ti·ªán.</a>



