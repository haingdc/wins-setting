Gi·ªõi thi·ªáu v·ªÅ l·∫≠p tr√¨nh ch·ª©c nƒÉng

B√†i vi·∫øt d·ª±a tr√™n b√†i vi·∫øt [A Gentle Introduction to Functional JavaScript: Part 3](https://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-functions) c·ªßa blogger James Sinclair nh·∫±m m·ª•c ƒë√≠ch h·ªçc t·∫≠p. N·∫øu th·∫•y h·ªØu √≠ch b·∫°n c√≥ th·ªÉ theo d√µi RSS c·ªßa [t√°c gi·∫£](https://jrsinclair.com/index.rss)

Ph·∫ßn 3

Vi·∫øt b·ªüi James Sinclair ng√†y 6<sup>th</sup> th√°ng 2 nƒÉm 2016

ƒê√¢y l√† ph·∫ßn ba trong 4 ph·∫ßn gi·ªõi thi·ªáu v·ªÅ l·∫≠p tr√¨nh ‚Äòch·ª©c nƒÉng‚Äô trong Javascript. ·ªû b√†i vi·∫øt tr∆∞·ªõc, ch√∫ng ta ƒë√£ t√¨m hi·ªÉu v·ªÅ c√°ch l·∫≠p tr√¨nh ch·ª©c nƒÉng tr√™n c√°c m·∫£ng v√† danh s√°ch. ·ªû b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω nghi√™n c·ª©u v·ªÅ 1 lo·∫°i h√†m c√≥ t√™n l√† __higher-order__.

+ Ph·∫ßn 1: [C√°c kh·ªëi x√¢y d·ª±ng v√† ƒë·ªông l·ª±c](https://medium.com/@vnknowledge/b%C3%A0i-d%E1%BB%8Bch-gi%E1%BB%9Bi-thi%E1%BB%87u-v%E1%BB%81-l%E1%BA%ADp-tr%C3%ACnh-ch%E1%BB%A9c-n%C4%83ng-7508808a39e5)
+ Ph·∫ßn 2: [L√†m vi·ªác v·ªõi m·∫£ng v√† danh s√°ch](https://medium.com/@vnknowledge/gioi-thieu-ve-lap-trinh-chuc-nang-p2-2b496ffaf524)
+ Ph·∫ßn 3: H√†m ƒë·ªÉ t·∫°o h√†m
+ Ph·∫ßn 4: L√†m vi·ªác v·ªõi phong c√°ch (s·∫Øp ƒë∆∞·ª£c d·ªãch)

# I. H√†m t·∫°o h√†m

Nh·∫Øc l·∫°i b√†i vi·∫øt tr∆∞·ªõc, ch√∫ng ta th·ª±c hi·ªán t√°ch m·ªôt s·ªë c√¢u l·ªánh sang c√°c h√†m ƒë∆°n gi·∫£n. Ti·∫øp ƒë√≥ ta thay th·∫ø _v√≤ng for_ th√¥ng th∆∞·ªùng v√†o trong h√†m _map_ v√† _reduce_. B√†i h√¥m nay s·∫Ω b√†n v·ªÅ c√°c ‚Äò_h√†m t·∫°o h√†m_‚Äô, ch√∫ng l√† nh·ªØng c√¥ng c·ª• gi√∫p ch√∫ng ta vi·∫øt code ng·∫Øn g·ªçn, x√∫c t√≠ch h∆°n.

H√†m t·∫°o h√†m ƒë√¥i khi c√≤n ƒë∆∞·ª£c bi·∫øt t·ªõi v·ªõi t√™n g·ªçi h√†m **higher-order**. ƒê·ªÉ hi·ªÉu ƒë∆∞·ª£c ch√∫ng, ch√∫ng ta c·∫ßn _‚Äògh√© thƒÉm‚Äô_ v√†i t√≠nh nƒÉng c·ªßa Javascript cho ph√©p n√≥ t·∫°o ra lo·∫°i h√†m n√†y. Th·∫£m kh·∫£o v·ªÅ [Higher-Order function ·ªü Wiki ](https://en.wikipedia.org/wiki/Higher-order_function) ƒë·ªÉ bi·∫øt th√™m.

# II. C√°c ch·∫•t li·ªáu ti·∫øp theo trong l·∫≠p tr√¨nh h√†m

\* B√†i vi·∫øt ƒë·∫ßu ti√™n c√≥ n√≥i t·ªõi 2 ch·∫•t li·ªáu ch√≠nh l√† _bi·∫øn_ v√† _h√†m_.

## 1. H√†m Closure v√† ph·∫°m vi c·ªßa bi·∫øn

M·ªôt trong nh·ªØng ph·∫ßn kh√≥ nh·∫±n trong Javascript l√† ch·ªó c√°c bi·∫øn m√† m·ªôt h√†m c√≥ th·ªÉ ‚Äòth·∫•y‚Äô. Gi·∫£ s·ª≠ ta khai b√°o bi·∫øn _x_ b√™n trong m·ªôt h√†m, bi·∫øn _x_ kh√¥ng th·ªÉ ƒë∆∞·ª£c th·∫•y b√™n ngo√†i h√†m ƒë√≥. V√≠ d·ª•:

```js
var thing = 'bat';

var sing = function() {
    // B√™n trong ‚Äòsing‚Äô c√≥ th·ªÉ th·∫•y bi·∫øn line
    var line = 'Twinkle, twinkle, little ' + thing;
    console.log(line);
};

sing();
// Twinkle, twinkle, little bat

// B√™n ngo√†i ‚Äòsing‚Äô, ch√∫ng ta kh√¥ng th·ªÉ th·∫•y bi·∫øn line
console.log(line);
// ‚õî Uncaught ReferenceError: line is not defined
```

Tuy nhi√™n, n·∫øu ta ƒë·ªãnh nghƒ©a m·ªôt h√†m ·ªü trong m·ªôt h√†m kh√°c, h√†m b√™n trong c√≥ th·ªÉ truy xu·∫•t t·ªõi bi·∫øn ·ªü h√†m b√™n ngo√†i:

```js
var outer = function() {
    var outerVar = 'Hatter';
    var inner = function() {
         // H√†m trong ‚Äòinner‚Äô c√≥ th·ªÉ th·∫•y bi·∫øn outerVar
         console.log(outerVar);
         // Hatter

         var innerVar = 'Dormouse';
         // üå≥üå≥ü¶çüåÑ ph·∫°m vi c·ªßa innerVar l√† trong h√†m inner, b√™n ngo√†i kh√¥ng th·ªÉ th·∫•y
    }

    // üôà a! innerVar ƒëi ƒë√¢u r·ªìi nh·ªâ?
    return inner;
}

var f = outer();
f();
```

C√≥ ƒëi·ªÉm b·∫°n s·∫Ω th·∫•y l√† sau khi th·ª±c thi xong h√†m _outer()_, bi·∫øn _outerVar_ kh√¥ng b·ªã m·∫•t ƒëi. N√™n khi g·ªçi _f()_, ch∆∞∆°ng tr√¨nh log ra k·∫øt qu·∫£ 'Hatter'. ƒê√¢y l√† ƒëi·ªÉm ƒë·∫∑c bi·ªát c·ªßa Javascript so v·ªõi c√°c ng√¥n ng·ªØ kh√°c. B·∫°n s·∫Ω m·∫•t ch√∫t th·ªùi gian ƒë·ªÉ l√†m quen v·ªõi ƒëi·ªÅu n√†y. N·∫øu g·∫∑p kh√≥ kh·∫Øn trong vi·ªác x√°c ƒë·ªãnh c√°c bi·∫øn m√† h√†m c√≥ th·ªÉ th·∫•y. ƒê·ª´ng v·ªôi lo l·∫Øng, _t·ªõi n∆°i h√†m ƒë∆∞·ª£c khai b√°o, ta ho√†n to√†n ph√°t hi·ªán ra c√°c bi·∫øn m√† h√†m ƒë√≥ th·∫•y ƒë∆∞·ª£c._

## 2. Bi·∫øn _‚Äòarguments‚Äô_

Khi b·∫°n t·∫°o m·ªôt h√†m trong Javascript, n√≥ s·∫Ω t·∫°o ra m·ªôt bi·∫øn ƒë·∫∑c bi·ªát t√™n l√† `arguments`. C·∫•u tr√∫c c·ªßa n√≥ kh√° gi·ªëng m·∫£ng. VD:

```js
var showArgs = function(a, b) {
    console.log(arguments);
}
showArgs('Tweedledee', 'Tweedledum');
//=> { '0': 'Tweedledee', '1': 'Tweedledum' } (üåü)
```

Quan s√°t k·∫øt qu·∫£, ta c√≥ nh·∫≠n x√©t sau

‚ñ™ **arguments** l√† m·ªôt ƒë·ªëi t∆∞·ª£ng c√≥ t√™n kh√≥a ·ª©ng v·ªõi c√°c ch·ªâ m·ª•c c·ªßa m·∫£ng nh∆∞ 0, 1,...

‚ñ™ ƒêi·ªÉm n·ªØa l√† __arguments__ ch·ª©a t·∫•t c·∫£ c√°c ƒë·ªëi s·ªë ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ g·ªçi h√†m, n√≥ kh√¥ng b·∫Øt bu·ªôc ph·∫£i ·ª©ng v·ªõi tham s·ªë ƒë∆∞·ª£c quy ƒë·ªãnh khi ƒë·ªãnh nghƒ©a h√†m. B√™n d∆∞·ªõi l√† v√≠ d·ª• m√† s·ªë l∆∞·ª£ng _tham s·ªë_ v√† _ƒë·ªëi s·ªë_ l√† kh√°c nhau:

```js
// ƒë·ªëi s·ªë √≠t h∆°n tham s·ªë
showArgs('less');
//=> { 0: "less" }

// ƒë·ªëi s·ªë nhi·ªÅu h∆°n tham s·ªë
showArgs('a', 'l', 'i', 'c', 'e');
//=> { '0': 'a', '1': 'l', '2': 'i', '3': 'c', '4': 'e' }
```

‚ñ™ Bi·∫øn __arguments__ c≈©ng c√≥ thu·ªôc t√≠nh ‚Äò_length_‚Äô gi·ªëng m·∫£ng:

```js
var argsLen = function() {
    console.log(arguments.length);
}
argsLen('a', 'l', 'i', 'c', 'e');
//=> 5
```

## 3. Call v√† Apply

Nh∆∞ ta bi·∫øt tr∆∞·ªõc ƒë√≥, c√°c m·∫£ng c√≥ s·∫µn c√°c ph∆∞∆°ng th·ª©c ch·∫£ h·∫°n nh∆∞ _.map_ v√† _.reduce_. ·ªû chi·ªÅu t∆∞∆°ng t·ª±, c√°c h√†m c≈©ng ƒë∆∞·ª£c cung c·∫•p cho m·ªôt v√†i ph∆∞∆°ng th·ª©c.

Th√¥ng th∆∞·ªùng ch√∫ng ta g·ªçi h√†m b·∫±ng c√°ch s·ª≠ d·ª•ng m·ªôt c·∫∑p ngo·∫∑c tr√≤n v√† truy·ªÅn v√†o c√°c ƒë·ªëi s·ªë:

```js
function twinkleTwinkle(thing) {
    console.log('Twinkle, twinkle, little ' + thing);
}
twinkleTwinkle('bat');
//=> Twinkle, twinkle, little bat
```

M·ªôt c√°ch kh√°c ƒë·ªÉ g·ªçi h√†m l√† s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c __call__:

```js
twinkleTwinkle.call(null, 'star');
//=> Twinkle, twinkle, little star
```

ƒê·ªëi s·ªë ƒë·∫ßu ti√™n th·ªÉ hi·ªán gi√° tr·ªã c·ªßa `this` m√† ta c√≥ th·ªÉ s·ª≠ d·ª•ng ·ªü ph·∫ßn th√¢n h√†m, hi·ªán t·∫°i ta kh√¥ng c·∫ßn quan t√¢m. C√°c ƒë·ªëi s·ªë th·ª© 2 tr·ªü ƒëi s·∫Ω ƒë∆∞·ª£c truy·ªÅn l·∫ßn l∆∞·ª£t t·ªõi h√†m.

Ph∆∞∆°ng th·ª©c __apply__ c√≥ ch·ª©c nƒÉng kh√° t∆∞∆°ng ƒë·ªìng v·ªõi __call__. Kh√°c nhau c∆° b·∫£n l√† __call__ nh·∫≠n m·ªôt danh s√°ch c√°c ƒë·ªëi s·ªë, trong khi __apply__ nh·∫≠n m·ªôt m·∫£ng c√°c ƒë·ªëi s·ªë ·ªü tham s·ªë th·ª© hai:

![call vs apply](call_vs_apply.png)

V√≠ d·ª•:

```js
twinkleTwinkle.apply(null, ['bat']);
//=> Twinkle, twinkle, little bat
```

C·∫£ hai ph∆∞∆°ng th·ª©c n√†y ƒë·ªÅu ƒë∆∞·ª£c s·ª≠ d·ª•ng khi ch√∫ng ta x√¢y d·ª±ng l√™n c√°c ‚Äò_h√†m t·∫°o h√†m_‚Äô.

## 4. H√†m n·∫∑c danh
M·ªôt h√†m n·∫∑c danh (c≈©ng ƒë∆∞·ª£c bi·∫øt t·ªõi v·ªõi t√™n g·ªçi _bi·ªÉu th·ª©c lambda_) l√† m·ªôt h√†m ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a nh∆∞ng kh√¥ng c√≥ t√™n. C√°c h√†m n·∫∑c danh th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng v·ªõi __map__ v√† __reduce__:

```js
var numbers = [1, 2, 3];
var doubledArray = map(function(x) { return x * 2}, numbers);
console.log(doubledArray);
//=> [ 2, 4, 6 ]
```

# III. √Åp d·ª•ng m·ªôt ph·∫ßn

‚ñ™ Trong khoa h·ªçc m√°y t√≠nh √°p d·ª•ng m·ªôt ph·∫ßn (t√™n kh√°c l√† ‚Äòh√†m √°p d·ª•ng m·ªôt ph·∫ßn‚Äô hay ‚Äòh√†m c·ª•c b·ªô‚Äô) l√† n√≥i t·ªõi vi·ªác c·ªë ƒë·ªãnh m·ªôt s·ªë l∆∞·ª£ng ƒë·ªëi s·ªë cho m·ªôt h√†m, t·∫°o ra m·ªôt h√†m m·ªõi v·ªõi s·ªë l∆∞·ª£ng ƒë·ªëi s·ªë nh·ªè h∆°n. Cho h√†m _f_, Ta c√≥ th·ªÉ c·ªë ƒë·ªãnh - **fix / bind** ƒë·ªëi s·ªë th·ª© nh·∫•t, t·∫°o ra h√†m c·ª•c b·ªô:

![partial](partial.png)

‚ñ™ V√≠ d·ª•, ta t·∫°o ra h√†m **addClass()** nh·∫≠n v√†o m·ªôt t√™n class v√† m·ªôt th·∫ª DOM:

```js
var addClass = function(className, element) {
    element.className += ' ' + className;
    return element;
}
```

Ch√∫ng ta mu·ªën s·ª≠ d·ª•ng h√†m n√†y v·ªõi __map__ ƒë·ªÉ th√™m class v√†o c√°c th·∫ª DOM.

```js
var map = function(callback, array) {
    var newArray = [];
    for (var i = 0; i < array.length; i = i + 1) {
        newArray[i] = callback(array[i], i);
    }
    return newArray;
}
```

K·∫øt h·ª£p _map_ v√† _addClass_:

```js
var ids = ['DEE', 'DUM'];

// (ch∆∞a c·∫ßn hi·ªÉu bind v·ªôi) M·ª•c ƒë√≠ch l√† ƒë·ªÉ thu ƒë∆∞·ª£c c√°c th·∫ª DOM c√≥ id l√† ‚ÄúDEE‚Äù, ‚ÄúDUM‚Äù
var elements = map(document.getElementById.bind(document), ids);

// th√™m t√™n class cho c√°c th·∫ª DOM thu ƒë∆∞·ª£c
map(addClass, elements);
```

‚ñ™ Tuy nhi√™n, ch∆∞∆°ng tr√¨nh tr√™n s·∫Ω kh√¥ng th·ª±c thi th√†nh c√¥ng b·ªüi m·ªôt v·∫•n ƒë·ªÅ: b√™n trong _map_, ta truy·ªÅn t·ª´ng ph·∫ßn t·ª≠ DOM t·ªõi tham s·ªë th·ª© nh·∫•t c·ªßa _callback_, d·∫´n t·ªõi g·ªçi _callback_ s·∫Ω kh√¥ng kh·ªõp v·ªõi _addClass_. Cho h√¨nh d∆∞·ªõi ƒë·ªÉ b·∫°n ti·ªán so s√°nh:

![no match](no_match.png)

Gi·∫£i ph√°p l√† t·∫°o m·ªôt h√†m m·ªõi, trong ƒë√≥ g·ªçi t·ªõi _addClass_, ƒë·ªìng th·ªùi ‚Äòfix-c·ª©ng‚Äô t√™n class ch√∫ng ta mu·ªën:

```js
var addTweedleClass = function(el) {
    return addClass('tweedle', el);
}
```

Gi·ªù ch√∫ng ta c√≥ m·ªôt h√†m ch·ªâ nh·∫≠n 1 tham s·ªë. N√≥ ph√π h·ª£p ƒë·ªÉ c√≥ th·ªÉ truy·ªÅn t·ªõi _map_:

```js
var ids = ['DEE', 'DUM'];
var elements = map(document.getElementById.bind(document), ids);
elements = map(addTweedleClass, elements);  // üåü
```

‚ñ™ Nh∆∞ng n·∫øu mu·ªën th√™m t√™n m·ªôt class kh√°c, ƒë√≤i h·ªèi ph·∫£i t·∫°o th√™m m·ªôt h√†m n·ªØa:

```js
var addBoyClass = function(el) {
    return addClass('boy', el);
}
```

ü§î c√≥ g√¨ ƒë√≥ ƒëang l·∫∑p l·∫°i!! - L√∫c n√£y s·∫Ω th·∫≠t tuy·ªát n·∫øu ta c√≥ m·ªôt h√†m chuy√™n ƒë·ªÉ c·ªë ƒë·ªãnh tham s·ªë ƒë·∫ßu ti√™n:

```js
var partialFirstOfTwo = function(fn, param1) {
    return function(param2) {
        return fn(param1, param2);
    }
}
```

Ch√∫ √Ω c√¢u l·ªánh `return` ƒë·∫ßu ti√™n. Ch√∫ng ta ƒëang t·∫°o m·ªôt h√†m m√† tr·∫£ v·ªÅ m·ªôt h√†m kh√°c.

```js
var addTweedleClass = partialFirstOfTwo(addClass, 'tweedle');
var addBoyClass = partialFirstOfTwo(addClass, 'boy');

var ids = ['DEE', 'DUM'];
var elements = map(document.getElementById.bind(document), ids);
elements = map(addTweedleClass, elements);
elements = map(addBoyClass, elements);
```

‚ñ™ C√≥ v·∫ª **partialFirstOfTwo** ho·∫°t ƒë·ªông kh√° ·ªïn v·ªõi h√†m nh·∫≠n ch√≠nh x√°c 2 tham s·ªë. Nh∆∞ng l√†m th·∫ø n√†o ƒë·ªÉ _‚Äò√°p d·ª•ng m·ªôt ph·∫ßn‚Äô_ v·ªõi h√†m nh·∫≠n 3 tham s·ªë? Hay c√≥ th·ªÉ l√† 4 ho·∫∑c h∆°n? T√≥m l·∫°i l√† m·ªôt h√†m gi√∫p fix-c·ª©ng cho nhi·ªÅu h∆°n m·ªôt tham s·ªë? V·ªõi y√™u c·∫ßu n√†y, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c _slice_ v√† _apply_ nh∆∞ sau:

```js
var argsToArray = function(args) {
    return Array.prototype.slice.call(args, 0);
}

var partial = function() {
    // chuy·ªÉn ƒë·ªïi ƒë·ªëi-t∆∞·ª£ng-gi·ªëng-m·∫£ng sang m·ªôt m·∫£ng m·ªõi
    var args = argsToArray(arguments);

    // shift() cho ph√©p l·∫•y ra ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n c·ªßa m·∫£ng. Trong tr∆∞·ªùng h·ª£p n√†y ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n l√† m·ªôt h√†m. args s·∫Ω ch·ª©a c√°c c√°c ƒë·ªëi s·ªë c√≤n l·∫°i.
    var fn = args.shift();  // üêò

    return function() {
        var remainingArgs = argsToArray(arguments);
        return fn.apply(this, args.concat(remainingArgs));  // üêò G·ªçi h√†m fn
    }
}
```

Hi·ªán t·∫°i, ch√∫ng ta ch∆∞a c·∫ßn n·∫Øm r√µ chi ti·∫øt h√†m _partial_ ho·∫°t ƒë·ªông. Ch·ªâ n√™n bi·∫øt r·∫±ng, h√†m n√†y cho ph√©p ch√∫ng ta _‚Äò√°p d·ª•ng m·ªôt ph·∫ßn/fix-c·ª©ng‚Äô_ m·ªôt s·ªë l∆∞·ª£ng ƒë·ªëi s·ªë b·∫•t k√¨ c·ªßa h√†m.

```js
var twinkle = function(noun, wonderAbout) {
    return 'Twinkle, twinkle, little ' +
        noun + '\nHow I wonder where you ' +
        wonderAbout;
}

// fix-c·ª©ng noun
var twinkleBat = partial(twinkle, 'bat');
twinkleBat('are at'); // Twinkle, twinkle, little bat\nHow I wonder where you are at

// fix-c·ª©ng noun v√† wonderAbout - √°p d·ª•ng to√†n ph·∫ßn/hard-coded!
var twinkleStar = partial(twinkle, 'star', 'are');
twinkleStar(); // Twinkle, twinkle, little star\nHow I wonder where you are
```

Javascript cung c·∫•p s·∫µn cho c√°c h√†m m·ªôt ph∆∞∆°ng th·ª©c ho·∫°t ƒë·ªông t∆∞∆°ng t·ª± _partial_ l√† _bind_. V·∫•n ƒë·ªÅ l√† n√≥ mong ch·ªù tham s·ªë ƒë·∫ßu ti√™n ph·∫£i l√† m·ªôt ƒë·ªëi t∆∞·ª£ng bi·∫øn `this` tham chi·∫øu t·ªõi. V√≠ d·ª•, n·∫øu mu·ªën _‚Äò√°p d·ª•ng m·ªôt ph·∫ßn‚Äô_ t·ªõi `document.getElementById`, b·∫°n ph·∫£i truy·ªÅn `document` ·ªü tham s·ªë ƒë·∫ßu ti√™n:

```js
var getWhiteRabbit = document.getElementById.bind(document, 'white-rabbit');
var rabbit = getWhiteRabbit();
```

D·∫´u v·∫≠y, ƒëa ph·∫ßn ta kh√¥ng ph·∫£i s·ª≠ d·ª•ng t·ªõi bi·∫øn `this` (ƒë·∫∑c bi·ªát vi·∫øt code theo c√°ch l·∫≠p tr√¨nh ch·ª©c nƒÉng), v√¨ v·∫≠y ta ch·ªâ c·∫ßn ƒë∆∞a `null` v√†o tham s·ªë th·ª© nh·∫•t. VD:

```js
var twinkleBat = twinkle.bind(null, 'bat');
var twinkleStar = twinkle.bind(null, 'star', 'are');
```

Xem th√™m v·ªÅ [.bind ·ªü trang MDN](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_objects/Function/bind)

## 1. t·ªïng h·ª£p h√†m - composition

Nh∆∞ c√°c b·∫°n ƒë√£ bi·∫øt ·ªü b√†i vi·∫øt tr∆∞·ªõc, l·∫≠p tr√¨nh ch·ª©c nƒÉng l√† v·ªÅ l·∫•y ra c√°c h√†m nh·ªè, ƒë∆°n gi·∫£n, ƒë·∫∑t ch√∫ng l·∫°i v·ªõi nhau ƒë·ªÉ gi·∫£i quy·∫øt nh·ªØng v·∫•n ƒë·ªÅ ph·ª©c t·∫°p h∆°n. Vi·∫øt code theo ki·ªÉu n√†y bao g·ªìm nhi·ªÅu kƒ© thu·∫≠t, nh∆∞  _‚Äò√Åp d·ª•ng m·ªôt ph·∫ßn‚Äô_ ƒë∆∞·ª£c n√≥i b√™n tr√™n. M·ªôt kƒ© thu·∫≠t kh√°c c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng l√† _‚ÄòT·ªïng h·ª£p h√†m‚Äô_, n√≥ gi√∫p k·∫øt h·ª£p c√°c h√†m l·∫°i v·ªõi nhau.

‚ñ™ D·∫°ng ƒë∆°n gi·∫£n nh·∫•t c·ªßa _t·ªïng h·ª£p h√†m_ g·ªìm 2 h√†m a v√† b, c·∫£ hai ƒë·ªÅu ch·ªâ nh·∫≠n 1 tham s·ªë. T·ªïng h·ª£p ch√∫ng cho ra h√†m c. K·∫øt qu·∫£ thu ƒë∆∞·ª£c t·ª´ b s·∫Ω l√† ƒë·ªëi s·ªë khi g·ªçi a. Gi√° tr·ªã thu ƒë∆∞·ª£c t·ª´ a l√† k·∫øt qu·∫£ c·ªßa c: c(x) = a(b(x)). V√≠ d·ª•:

```js
var composeTwo = function(funA, funB) {
    return function(x) {
        return funA(funB(x));
    }
}

var nohow = function(sentence) {
    return sentence + ', nohow!';
}
var contrariwise = function(sentence) {
    return sentence + ' Contrariwise‚Ä¶';
}

var statement = 'Not nothin&amp;rsquo;';
var funC = composeTwo(contrariwise, nohow);
console.log(funC(statement));
//=> Not nothin&amp;rsquo;, nohow! Contrariwise‚Ä¶
```

H√†m composeTwo gi√∫p k·∫øt h·ª£p 2 h√†m funA v√† funB ra funC. Tuy nhi√™n, ch√∫ng ta c√≥ th·ªÉ mu·ªën k·∫øt h·ª£p nhi·ªÅu h∆°n 2 h√†m v·ªõi nhau. ƒêi·ªÅu n√†y ƒë√≤i h·ªèi m·ªôt h√†m t·ªïng h·ª£p c√≥ t√≠nh kh√°i qu√°t h∆°n:

```js
var compose = function() {
    var args = arguments;
    var start = args.length - 1;
    return function() {
        var i = start;
        var result = args[start].apply(this, arguments);
        i = i - 1;
        while (i >= 0) {
            result = args[i].call(this, result);
            i = i - 1;
        }
        return result;
    };
};
```

M·ªôt l·∫ßn n·ªØa, g·∫°t ph·∫ßn body c·ªßa h√†m **compose** sang m·ªôt b√™n, h√£y ch√∫ √Ω t·ªõi nh·ªØng g√¨ m√† n√≥ l√†m ƒë∆∞·ª£c. Khi √°p d·ª•ng v√†o v√≠ d·ª• tr√™n:

```js
var funC = compose(contrariwise, nohow);
```

L·ª£i √≠ch c·ªßa h√†m t·ªïng h·ª£p s·∫Ω r√µ h∆°n khi ch√∫ng ta t√¨m hi·ªÉu v·ªÅ h√†m _currying_ n√≥i t·ªõi ·ªü ph·∫ßn sau.

‚ñ™ V·ªõi m·ªôt v√†i h√†m ti·ªán √≠ch nh·ªè, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng _compose_ ƒë·ªÉ l√†m cho code ƒë∆∞·ª£c r√µ r√†ng, ng·∫Øn g·ªçn. V√≠ d·ª•, ta c√≥ m·ªôt b√†i th∆° sau:

```js
var poem = 'Twas brillig, and the slithy toves\n' +
    'Did gyre and gimble in the wabe;\n' +
    'All mimsy were the borogoves,\n' +
    'And the mome raths outgrabe.';
```

\* brillig: Trong t·ª´ ƒëi·ªÉn nghƒ©a l√† _4h chi·ªÅu, l√† l√∫c m√† b·∫°n b·∫Øt ƒë·∫ßu n∆∞·ªõng (broiling) g√¨ ƒë√≥ cho b·ªØa t·ªëi._

V·ªõi ƒë·ªãnh d·∫°ng nh∆∞ n√†y, b√†i th∆° s·∫Ω kh√¥ng ƒë∆∞·ª£c hi·ªÉn th·ªã t·ªët l·∫Øm tr√™n tr√¨nh duy·ªát. N√≥ n√™n ƒë∆∞·ª£c ƒë·ªãnh d·∫°ng theo chu·∫©n HTML. Tr∆∞·ªõc h·∫øt ch√∫ng ta c·∫ßn d·ªãch t·ª´ ‚Äòbrillig‚Äô sang m·ªôt d·∫°ng d·ªÖ hi·ªÉu h∆°n cho ng∆∞·ªùi ƒë·ªçc. Sau ƒë√≥ ta ƒë∆∞a t·∫•t c·∫£ v√†o trong 2 th·∫ª HTML l√† `<p>` v√† `<blockquote>`. H√£y t·∫°o 2 h√†m ƒë∆°n gi·∫£n nh∆∞ sau:

```js
var replace = function(find, replacement, str) {
    return str.replace(find, replacement);
}

var wrapWith = function(tag, str) {
    return '<' + tag + '>' + str + '</' + tag + '>';
}

var addBreaks      = partial(replace, '\n', '<br/>\n');
var replaceBrillig = partial(replace, 'brillig', 'four o‚Äôclock in the afternoon');
var wrapP          = partial(wrapWith, 'p');
var wrapBlockquote = partial(wrapWith, 'blockquote');

var modifyPoem = compose(wrapBlockquote, wrapP, addBreaks, replaceBrillig);

console.log(modifyPoem(poem));
//=> <blockquote><p>Twas four o‚Äôclock in the afternoon, and the slithy toves<br/>
//   Did gyre and gimble in the wabe;<br/>
//   All mimsy were the borogoves,<br/>
//   And the mome raths outgrabe.</p></blockquote>
```

Ch√∫ √Ω n·∫øu b·∫°n ƒë·ªçc c√°c ƒë·ªëi s·ªï ·ªü __compose__ t·ª´ tr√°i sang ph·∫£i, ch√∫ng s·∫Ω ƒë∆∞·ª£c g·ªçi theo th·ª© t·ª± ng∆∞·ª£c l·∫°i. C√°c b·∫°n c√≥ th·ªÉ th·∫•y m·ªôt ch√∫t b·ªëi r·ªëi, b·ªüi v·∫≠y, m·ªôt s·ªë th∆∞ vi·ªán l·∫≠p tr√¨nh ch·ª©c nƒÉng cung c·∫•p c√°c h√†m th·ª±c thi theo chi·ªÅu thu·∫≠n t√™n l√† _pipe_ hay _flow_.

S·ª≠ d·ª•ng _pipe_, ch√∫ng ta c√≥ th·ªÉ vi·∫øt _modifyPoem_ nh∆∞ sau:

```js
var modifyPoem = pipe(replaceBrillig, addBreaks, wrapP, wrapBlockquote);
```

## 2. Currying

Gi·ªõi h·∫°n c·ªßa _‚Äòcompose‚Äô_ l√† n√≥ coi c√°c h√†m truy·ªÅn v√†o ƒë·ªÅu ch·ªâ nh·∫≠n 1 tham s·ªë. N√≥ kh√¥ng ph·∫£i v·∫•n ƒë·ªÅ g√¨ l·ªõn v√¨ ta ƒë√£ c√≥ _‚Äòpartial‚Äô_, n√≥ c√≥ th·ªÉ chuy·ªÉn ƒë·ªïi h√†m nhi·ªÅu tham s·ªë t·ªõi h√†m m·ªôt tham s·ªë. Tuy nhi√™n, _partial_ v·∫´n ch∆∞a ƒë·ªß. H√†m curry c√≥ th·ªÉ l√† m·ªôt gi·∫£i ph√°p, c√≥ th·ªÉ coi l√† l√† phi√™n b·∫£n ‚Äò_k√≠ch th√≠ch c·ªßa partial_‚Äô.

Chi ti·∫øt c·ªßa _currying_ c√≥ ch√∫t ph·ª©c t·∫°p. Tr∆∞·ªõc ti√™n h√£y xem m·ªôt v√≠ d·ª•. Ch√∫ng ta c√≥ h√†m _formatName_ d√πng ƒë·ªÉ ƒë·∫∑t t√™n ng∆∞·ªùi v√†o trong d·∫•u ch√∫ th√≠ch. N√≥ c√≥ 3 tham s·ªë. Phi√™n b·∫£n ƒë∆∞·ª£c _curry-h√≥a_ (ƒë·ªÉ d·ªÖ g·ªçi t√¥i s·∫Ω vi·∫øt lo·∫°i h√†m n√†y v·ªõi t√™n l√† h√†m c√†-ri) c·ªßa _formatName_ s·∫Ω c√≥ √≠t h∆°n 3 tham s·ªë, n√≥ c√≥ v√†i tham s·ªë ƒë∆∞·ª£c _‚Äò√°p d·ª•ng m·ªôt ph·∫ßn‚Äô_:

```js
var formatName = function(firstname, surname, nickname) {
    return firstname + ' ‚Äú' + nickname + '‚Äù ' + surname;
}
var formatNameCurried = curry(formatName);  // üçõ c∆°m c√†-ri

var james = formatNameCurried('James');  // ‚öì fix firstname

console.log(james('Sinclair', 'Mad Hatter'));  // üìû g·ªçi v·ªõi surname, nickname
//=> James ‚ÄúMad Hatter‚Äù Sinclair

var jamesS = james('Sinclair')  // ‚öì fix surname

console.log(jamesS('Dormouse'));  // üìû g·ªçi v·ªõi nickname
//=> James ‚ÄúDormouse‚Äù Sinclair

console.log(jamesS('Bandersnatch'));  // üìû g·ªçi v·ªõi nickname
//=> James ‚ÄúBandersnatch‚Äù Sinclair
```

C√≥ v√†i th·ª© c·∫ßn ch√∫ √Ω v·ªÅ h√†m ‚Äòc√†-ri‚Äô:

```js
formatNameCurried('a');  // ‚ÄòformatName‚Äô kh√¥ng ƒë∆∞·ª£c g·ªçi, tr·∫£ v·ªÅ h√†m c√†-ri
formatNameCurried('a')('b');  // ‚ÄòformatName‚Äô kh√¥ng ƒë∆∞·ª£c g·ªçi, tr·∫£ v·ªÅ h√†m c√†-ri
formatNameCurried('a', 'b');  // ‚ÄòformatName‚Äô kh√¥ng ƒë∆∞·ª£c g·ªçi, tr·∫£ v·ªÅ h√†m c√†-ri

formatNameCurried('a')('b')('c');  // ‚á® a ‚Äúc‚Äù b
formatNameCurried('a', 'b', 'c');  // ‚á® a ‚Äúc‚Äù b
formatNameCurried('a', 'b')('c');  // ‚á® a ‚Äúc‚Äù b
formatNameCurried('a')('b', 'c');  // ‚á® a ‚Äúc‚Äù b
```

ƒê√¢y l√† code ƒë·ªÉ b·∫°n ti·ªán so s√°nh gi·ªØa [currying](formatNameCurried.html) v√† [partial](formatNamePartial.html).

N√≥ v·∫´n ch∆∞a th·ªÉ hi·ªán l·ª£i √≠ch g√¨ h∆°n so v·ªõi ‚Äò_partial_‚Äô. Nh∆∞ng currying s·∫Ω tr·ªü n√™n v√¥ c√πng h·ªØu d·ª•ng khi ƒëi c√πng h√†m t·ªïng h·ª£p.

Quay l·∫°i v√≠ d·ª• b√†i th∆° ph√≠a tr√™n, s·∫Ω th·∫ø n√†o n·∫øu ta mu·ªën ƒë∆∞a c√¢u ‚Äò_four o‚Äôclock in the afternoon_‚Äô v√†o trong th·∫ª `<em>`?

```js
var replace = curry(function(find, replacement, str) {  // üé≠ 
    var regex = new RegExp(find, 'g');
    return str.replace(regex, replacement);
});

var wrapWith = curry(function(tag, str) {  // üé≠
    return '<' + tag + '>' + str + '</' + tag + '>';
});

var modifyPoem = pipe(
    replace('brillig', wrapWith('em', 'four o‚Äôclock in the afternoon')),  // ‚öì fix ths·ªë 1 & 2
    replace('\n', '<br/>\n'),  // ‚öì fix ths·ªë 1 & 2
    wrapWith('p'),             // ‚öì fix ths·ªë 1
    wrapWith('blockquote')     // ‚öì fix ths·ªë 1
);

console.log(modifyPoem(poem));
//=> <blockquote><p>Twas <em>four o‚Äôclock in the afternoon</em>, and the slithy toves<br/>
//   Did gyre and gimble in the wabe;<br/>
//   All mimsy were the borogoves,<br/>
//   And the mome raths outgrabe.</p></blockquote>
```

ƒê·ªÉ √Ω, ta s·ª≠ d·ª•ng h√†m _pipe_ thay v√¨ _compose_. C≈©ng kh√¥ng c√≥ h√†m trung gian n·ªØa, s·ª≠ d·ª•ng h√†m n·∫∑c danh (üé≠). Khi g·ªçi _pipe_ ta s·∫Ω truy·ªÅn v√†o c√°c h√†m ‚Äòc√†-ri‚Äô. Ch√∫ng c≈©ng d·ªÖ ƒë·ªçc ƒë·∫•y ch·ª©!

ƒê√¢y l√† code ƒë·ªÉ b·∫°n ti·ªán so s√°nh gi·ªØa [partial](formatNameCurryLodash.html) v√† [currying](formatNamePartialLodash.html) s·ª≠ d·ª•ng th∆∞ vi·ªán Lodash. T√¥i thay th·∫ø pipe b·∫±ng flow.

B√™n d∆∞·ªõi ƒë·ªãnh nghƒ©a h√†m _curry_ ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh t·ª´ cu·ªën [JavaScript Allong√©](https://leanpub.com/javascript-allonge). M·ªôt l·∫ßn n·ªØa, h√£y t·∫≠p trung v√†o √Ω nghƒ©a c·ªßa h√†m thay v√¨ chi ti·∫øt b√™n trong.

```js
function curry (fn) {
    var arity = fn.length;

    function given (argsSoFar) {
        return function helper () {
            var args             = Array.prototype.slice.call(arguments, 0);
            var updatedArgsSoFar = argsSoFar.concat(args);

            if (updatedArgsSoFar.length >= arity) {
                return fn.apply(this, updatedArgsSoFar);
            }
            else {
                return given(updatedArgsSoFar);
            }
        }
    }

    return given([]);
}
```

## 3. T·∫°i sao?

V·∫≠y l√† ta ƒë√£ ƒëi t√¨m hi·ªÉu v·ªÅ nh·ªØng ƒë·∫∑c ƒëi·ªÉm v√† ·ª©ng d·ª•ng c·ªßa _partial_, _compose_, _pipe_ v√† _curry_. Ch√∫ng l√† nh·ªØng c√¥ng c·ª• gi√∫p √≠ch trong vi·ªác l·∫Øp gh√©p c√°c h√†m nh·ªè, ƒë∆°n gi·∫£n ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ l·ªõn h∆°n. Nh∆∞ng ch√∫ng c√≥ th·ª±c s·ª± h·ªØu √≠ch? Ch√∫ng l√†m ƒë∆∞·ª£c ƒëi·ªÅu g√¨ kh√°c so v·ªõi tr∆∞·ªõc ƒë√¢y? Qu·∫£ th·∫≠t, n√≥ m·ªü ra m·ªôt phong c√°ch m·ªõi cho vi·ªác vi·∫øt code. N√≥ ƒë∆∞a ta nghƒ© theo m·ªôt con ƒë∆∞·ªùng kh√°c, c√≥ th·ªÉ ƒë∆°n gi·∫£n h∆°n trong gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ. N√≥ c≈©ng gi√∫p gi·∫£m bug, d·ªÖ ki·ªÉm tra code ƒë∆∞·ª£c vi·∫øt ra (H√£y th·ª≠ v√† ƒë√°nh gi√° nh√©). N·∫øu b·∫°n c√≤n th·∫•y h·ª©ng th√∫, xin m·ªùi ƒë√≥n ƒë·ªçc b√†i vi·∫øt t·ªõi.